name: "hanime"

sceneByFragment:
  action: scrapeXPath
  queryURL: https://hanime.tv/videos/hentai/{filename}
  queryURLReplace:
    filename:
      # [HSUB] Anime_02_Title - sub eng - E05v2 Uncensored (HD) www.example.com [3bb935c6].mp4
      # 1. Removes tags inside square brackets [xxx]
      - regex: '\[[^\]]*\]'
        with: ""
      
      # 2. Removes tags inside parentheses (xxx)
      - regex: '\([^)]*\)'
        with: ""
      
      # 3. Removes file extensions (.mp4, .avi, .mkv...)
      - regex: '\.\w{2,4}$'
        with: ""
      
      # 4. Removes known tags: sub eng, engsub, uncensored, www
      - regex: '(?i)(sub[\s\-_]?eng|engsub|uncensored|censored|www\.[^\s]+)'
        with: ""

      # 5. Standardizes separators into hyphens
      - regex: '[\s\._+]+'
        with: '-'
        
      # 6. Removes extended prefixes for episodes and seasons (but keeps the number)
      - regex: '(?i)(^|[\-])(?:ep|episode|episodio|act|vol|season|stagione)([\-]?\d{1,2})'
        with: '$1$2'
        
      # 7. Converts short prefixes for seasons and episodes into numbers (e.g., S02E05 → 02-05)
      - regex: '(?i)\b(e|s)(\d{1,2})((e|s)(\d{1,2}))?\b'
        with: '$2-$5'

      # 8. Removes version suffixes from numbers (v2, vFinal, vRev3)
      - regex: '(?i)(\d{1,2})(?:-)?v(?:\d+|final|finale|rev\d*)\b'
        with: '$1'

      # 9. Converts any short number (max 2 digits) with a leading zero into -<number>
      - regex: '(^|[^0-9])0?(\d{1,2})([^0-9]|$)'
        with: '$1$2$3'
      
      # 10. Replaces invalid URL characters (but keeps hyphens)
      - regex: '[^a-zA-Z0-9\-]+'
        with: '-'
      
      # 11. Inserts a hyphen between letters and numbers (e.g., "abc2" → "abc-2")
      - regex: '([a-zA-Z])(\d)'
        with: '$1-$2'
        
      # 12. Removes everything after the last short number
      - regex: '^(.*-\d{1,2})(?:-\d{1,2})*(?:-.*)?$'
        with: '$1'
        
      # 13. Multiple hyphens → only one
      - regex: '-+'
        with: '-'
      
      # 14. Removes leading/trailing hyphens (with #12, trailing ones are already removed)
      - regex: '^-+|-+$'
        with: ""
  scraper: sceneScraper

sceneByURL:
  - action: scrapeXPath
    url:
      - hanime.tv/videos/hentai/
    scraper: sceneScraper

sceneByName:
  action: script
  script:
    - python
    - hanime.py

sceneByQueryFragment:
  action: script
  script:
    - python
    - hanime.py

xPathScrapers:
  sceneScraper:
    scene:
      Title:
        selector: //h1[@class="tv-title"]/text()
        postProcess:
          - replace:
              - regex: '(?i)\s+(?:ep\.?|(?:- )?episode)?\s*(\d+)$'
                with: ' ep$1'
              - regex: ' ep(\d{1})$'
                with: ' ep0$1'
      Date: &date
        selector: //div[@class="hvpimbc-item"]/div[contains(.,"Release Date")]/../div[@class="hvpimbc-text grey--text"]/text()
        postProcess:
          - parseDate: January 2, 2006
      Details: &details
        selector: //div[@class="mt-3 mb-0 hvpist-description"]//text()
        concat: "\n\n"
      Tags:
        Name:
          selector: //div[@class="hvpis-text grey--text text--lighten-1"]/a/div
          postProcess:
            - map:
                "hd": ""
      Studio:
        Name:
          selector: //div[@class="hvpimbc-item full"]/a[@class="hvpimbc-text"]/text()
      Image:
        selector: //script[contains(., "poster_url")]
        postProcess:
          - replace:
              - regex: '(.+?poster_url":")(.+?)(","cover_url".+)'
                with: '$2'
              - regex: 'u002F'
                with: ""
              - regex: '\\'
                with: '/'
              - regex: 'static-assets.highwinds-cdn.com'
                with: 'static-assets.droidbuzz.top'
              - regex: 'https://'
                with: 'https://i1.wp.com/'
      # build the url from the cover:
      URL:
        selector: //img[@class="hvpi-cover"]/@src
        postProcess:
          - replace:
              - regex: '^.*/([^/]+)\.[a-zA-Z0-9]+$'
                with: '$1'
              - regex: '(.+-\d+)(?:-[^-]+)?$'
                with: 'https://hanime.tv/videos/hentai/$1'
      Movies:
        Name:
          selector: //h1[@class="tv-title"]/text()
          postProcess:
            - replace:
                - regex: '(?i)\s+(?:ep\.?|(?:- )?episode)?\s*(\d+)$'
                  with: ""
        Aliases: //h2/span[@class="mr-3 grey--text"]/text()
        Date: *date
        Synopsis: *details
        FrontImage:
          selector: //script[contains(., "cover_url")]
          postProcess:
            - replace:
                - regex: '(.+?cover_url":")(.+?)(",".+)'
                  with: '$2'
                - regex: 'u002F'
                  with: ""
                - regex: '\\'
                  with: '/'
                - regex: '(.+-)(\d+)(-?[^-]+)$'
                  with: '${1}1${3}'

# Last Updated June 24, 2025
